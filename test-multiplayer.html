<!DOCTYPE html>
<html>
<head>
    <title>×‘×“×™×§×ª ××•×œ×˜×™ ×¤×œ×™×™×¨</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial; background: #222; color: white; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .status { background: #333; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .online { background: #2a5d2a; }
        .offline { background: #5d2a2a; }
        .test-btn { background: #4CAF50; color: white; border: none; padding: 10px 20px; margin: 5px; cursor: pointer; border-radius: 3px; }
        .test-btn:hover { background: #45a049; }
        #log { background: #111; padding: 10px; height: 300px; overflow-y: auto; font-family: monospace; border: 1px solid #444; }
    </style>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <div class="container">
        <h1>ğŸ® ×‘×“×™×§×ª ××¢×¨×›×ª ×¨×‘-××©×ª×ª×¤×™×</h1>
        
        <div id="status" class="status offline">
            <strong>×¡×˜×˜×•×¡:</strong> <span id="statusText">×œ× ××—×•×‘×¨</span>
        </div>
        
        <div class="status">
            <strong>××¡×¤×¨ ×©×—×§× ×™× ××—×•×‘×¨×™×:</strong> <span id="playerCount">0</span>
        </div>
        
        <div>
            <button class="test-btn" onclick="connectToServer()">×”×ª×—×‘×¨ ×œ×©×¨×ª</button>
            <button class="test-btn" onclick="disconnectFromServer()">×”×ª× ×ª×§ ××”×©×¨×ª</button>
            <button class="test-btn" onclick="sendTestMessage()">×©×œ×— ×”×•×“×¢×” ×œ×‘×“×™×§×”</button>
            <button class="test-btn" onclick="clearLog()">× ×§×” ×œ×•×’</button>
        </div>
        
        <div>
            <input type="text" id="testMessage" placeholder="×”×§×œ×“ ×”×•×“×¢×” ×œ×‘×“×™×§×”..." style="width: 300px; padding: 8px; margin: 5px;">
            <input type="text" id="playerName" placeholder="×©× ×©×—×§×Ÿ" value="×‘×•×“×§1" style="width: 150px; padding: 8px; margin: 5px;">
        </div>
        
        <h3>ğŸ“‹ ×œ×•×’ ××™×¨×•×¢×™×:</h3>
        <div id="log"></div>
    </div>
    
    <script>
        let socket = null;
        let isConnected = false;
        
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString('he-IL');
            logDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }
        
        function updateStatus(connected, text) {
            const statusDiv = document.getElementById('status');
            const statusText = document.getElementById('statusText');
            
            if (connected) {
                statusDiv.className = 'status online';
                statusText.textContent = text || '××—×•×‘×¨';
            } else {
                statusDiv.className = 'status offline';
                statusText.textContent = text || '×œ× ××—×•×‘×¨';
            }
        }
        
        function updatePlayerCount(count) {
            document.getElementById('playerCount').textContent = count;
            log(`ğŸ“Š ×¢×“×›×•×Ÿ ××¡×¤×¨ ×©×—×§× ×™×: ${count}`);
        }
        
        function connectToServer() {
            if (isConnected) {
                log('âš ï¸ ×›×‘×¨ ××—×•×‘×¨ ×œ×©×¨×ª');
                return;
            }
            
            try {
                log('ğŸ”— ×× ×¡×” ×œ×”×ª×—×‘×¨ ×œ×©×¨×ª...');
                socket = io();
                setupSocketListeners();
                
            } catch (error) {
                log('âŒ ×©×’×™××” ×‘×”×ª×—×‘×¨×•×ª: ' + error.message);
            }
        }
        
        function setupSocketListeners() {
            socket.on('connect', () => {
                log('âœ… ×”×ª×—×‘×¨×ª ×œ×©×¨×ª ×‘×”×¦×œ×—×”!');
                isConnected = true;
                updateStatus(true, '××—×•×‘×¨');
                
                // ×”×¦×˜×¨×£ ×œ××©×—×§
                const playerName = document.getElementById('playerName').value || '×‘×•×“×§1';
                const playerData = {
                    name: playerName,
                    x: Math.random() * 2000 + 1000,
                    y: Math.random() * 2000 + 1000,
                    angle: 0,
                    coins: 100,
                    adminMode: false,
                    explorerMode: false,
                    equipped: {},
                    ownedItems: []
                };
                
                log(`ğŸ“¤ ×©×•×œ×— playerJoin ×¢× × ×ª×•× ×™×: ${playerName}`);
                socket.emit('playerJoin', playerData);
            });
            
            socket.on('disconnect', () => {
                log('âŒ × ×•×ª×§ ××”×©×¨×ª');
                isConnected = false;
                updateStatus(false, '× ×•×ª×§');
            });
            
            socket.on('playerJoined', (playerData) => {
                log(`ğŸ‘‹ ×©×—×§×Ÿ ×—×“×© ×”×¦×˜×¨×£: ${playerData.name} (ID: ${playerData.id})`);
            });
            
            socket.on('playerLeft', (playerId) => {
                log(`ğŸ‘‹ ×©×—×§×Ÿ ×¢×–×‘: ${playerId}`);
            });
            
            socket.on('playerCountUpdate', (count) => {
                updatePlayerCount(count);
            });
            
            socket.on('chatMessage', (messageData) => {
                log(`ğŸ’¬ ×”×•×“×¢×ª ×¦'××˜ ×-${messageData.playerName}: ${messageData.message}`);
            });
            
            socket.on('gameState', (gameState) => {
                log(`ğŸ® ×§×™×‘×œ× ×• ××¦×‘ ××©×—×§ - ××˜×‘×¢×•×ª: ${gameState.coins.length}, ××ª× ×•×ª: ${gameState.gifts.length}`);
            });
        }
        
        function disconnectFromServer() {
            if (!isConnected || !socket) {
                log('âš ï¸ ×œ× ××—×•×‘×¨ ×œ×©×¨×ª');
                return;
            }
            
            log('ğŸ”Œ ××ª× ×ª×§ ××”×©×¨×ª...');
            socket.disconnect();
            socket = null;
            isConnected = false;
            updateStatus(false, '×”×ª× ×ª×§');
        }
        
        function sendTestMessage() {
            if (!isConnected || !socket) {
                log('âŒ ×œ× × ×™×ª×Ÿ ×œ×©×œ×•×— ×”×•×“×¢×” - ×œ× ××—×•×‘×¨');
                return;
            }
            
            const message = document.getElementById('testMessage').value.trim() || '×”×•×“×¢×ª ×‘×“×™×§×”';
            log(`ğŸ“¤ ×©×•×œ×— ×”×•×“×¢×ª ×‘×“×™×§×”: ${message}`);
            
            socket.emit('chatMessage', {
                message: message
            });
            
            document.getElementById('testMessage').value = '';
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        // ×”×ª×—×‘×¨ ××•×˜×•××˜×™×ª
        window.addEventListener('load', () => {
            log('ğŸš€ ×“×£ × ×˜×¢×Ÿ - ×××ª×™×Ÿ ×œ×”×ª×—×‘×¨×•×ª...');
            setTimeout(() => {
                connectToServer();
            }, 1000);
        });
        
        // ×”×ª× ×ª×§ ×‘×¢×ª ×¡×’×™×¨×ª ×”×“×£
        window.addEventListener('beforeunload', () => {
            if (socket) {
                socket.disconnect();
            }
        });
    </script>
</body>
</html>